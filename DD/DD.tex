\documentclass{report}
\usepackage[utf8]{inputenc}
\usepackage{natbib}
\usepackage{graphicx}
\usepackage[pagestyles]{titlesec}
\usepackage[hidelinks]{hyperref}
\usepackage{pdfpages}
\usepackage{booktabs}
\usepackage{array}
\usepackage{ltablex}
\usepackage{multicol}
\usepackage{capt-of}
\usepackage{float}

\title{Design Document}
\author{AmorosiniCasaliFioravanti}
\date{December 2019}

\titleformat{\chapter}[display]{\normalfont\bfseries}{}{0pt}{\Huge}
\newpagestyle{mystyle}
{\sethead[\thepage][][\chaptertitle]{}{}{\thepage}}
\pagestyle{mystyle}

\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}
\newcolumntype{Y}{>{\centering\arraybackslash}X}

\begin{document}

\includepdf[pages={1}]{./img/FrontPage}

\tableofcontents

\chapter{Introduction}
\section{Purpose}
While the RASD presented a general view of the SafeStreets appliction and its features, this document aims to further analyze the system's design and architecture, as well as describing for each of its components their runtime behaviour, integration, interfaces, implementation and testing plans.
This document is mainly intended to be used by the test and development teams as a guidance in the development process, but also to prevent structural degradation during maintainance and extension phases. Nonetheless, the document is also addressed to all the stakeholders who are interested in supervising the development process.

\section{Scope}
SafeStreets is a mobile application that aims to improve the safety of urban areas by giving its users the possibility to report traffic violations to authorities. Users are logged in either as citizen, those who report the violations, or authorities, those who are notified about newly reported violations and are supposed to take action on them.\\
The system is in charge of collecting all the reports, storing them, and notifying the authorities about them. The stored reports are then used to build statistics, find unsafe areas, and compute suggestions on how to improve the safety of such areas. The system may also interact with local Municipalities' Systems in order to retrieve information about accidents and iussued traffic tickets: in this case some of the above functions are enhanced, and some new functions are enabled (g.e computing statistics on traffic tickets).\\
\newline
Further information about the scope of the application can be found in the Chapter 1 of the RASD.

\section{Definitions, Acronyms and Abbreviations}
\subsection{Definitions}
\begin{itemize}
    \item \textit{Client}: a piece of computer hardware or software that accesses a resource or a service made available by a Server.
    \item \textit{Server}: a device or a computer program that provides resources or functionalities to other programs or devices.
    \item \textit{Firewall}: a network security systems that monitors incoming and outcoming network traffic, applying predefined predefined security rules.
    \item \textit{Microservice}: a basic function of the application exectuted independently from the others.
\end{itemize}
\subsection{Acronyms}
\begin{itemize}
    \item \textbf{RASD}: \textit{Requirement Analysis and Specification Document}, the document in which all the requirements and goals of the application are throughly described.
    \item \textbf{API}: \textit{Application Programming Interface}, interface, or communication protocol between Client and Server intendend to simplify the building of the Client-side software.
    \item \textbf{GPS}: \textit{Global Positioning system}, technology widely used to get the user's position.
    \item \textbf{DBMS}: \textit{Data Base Management system}, software that provides organized space memory to store information.
    \item \textbf{OCR}: \textit{Optical Character Recognition}, software dedicated to the detection of characters contained in a document and to their transfer to digital text that can be read by a machine. In this context, OCR will be used to read license plates.
    \item \textbf{UML}: \textit{Unified Modeling Language}, a standard visual modeling language intended to be used for analysis, design, and implementation of software-based systems.
    \item \textbf{MVC}: \textit{Model View Controller}, a software design pattern commonly used to provide user interfaces.
    \item \textbf{CRUD}: \textit{Create, Read, Update, Delete}. These are the basic four operations which allow users to interact with a resource in a relational database (\texttt{INSERT}, \texttt{SELECT},\texttt{UPDATE}, \texttt{DELETE}).
    \item \textbf{UX}: \textit{User eXperience}, a diagram used to describe the interfaces provided by the application.
    \end{itemize}
\subsection{Abbreviations}
\begin{itemize}
    \item {[R$_{i}$]}: i-th requirement.
    \end{itemize}
\section{Reference Documents}
\begin{itemize}
    \item Specification document: \textit{SafeStreets Mandatory Project Assignment.pdf}.
    \item Requirement Analysis and Specification Document: \textit{RASD.pdf}.
\end{itemize}
\section{Document Structure}
This document is presented as it follows:
\begin{enumerate}
    \item \textbf{Introduction} presents a general overview, the scope and the purpose of the document.
    \item \textbf{Architectural Design} shows the main components of the system and their relationships. This section will also discuss the architectural choices of the design process.
    \item \textbf{User Interface Design} provides some further details to the user interface defined in the RASD.
    \item \textbf{Requirement Traceability} maps all the functional requirements defined in the RASD over the components that will accomplish them.
    \item \textbf{Implementation, Integration and Testing Plans} shows the order in which the implementation and the integration of the components will occur, and how the testing phase will be carried out.
    \item {\textbf{Effort spent}} displays the time spent writing this document by each member of the team.
\end{enumerate}
\chapter{Architectural Design}
\section{Overview}
In this chapter the architectural structure of the system will be discussed at multiple levels of abstraction. A high-level view of the components and their interactions is represented in Figure \ref{fig:overview}. The details will be explained in the following sections.
\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/HighLevelOverview.png}
    \end{center}
    \label{fig:overview}
	\caption{High-level overview of the system.}
\end{figure}
\newpage
\section{Component view}
The UML component diagram in Figure \ref{fig:componentdiagram} aims at capturing the internal modular structure of the components, showing how they are connected together in order to form larger components. Components are wired together by using an assembly connector to connect the required interface of one component with the provided interface of another component.
\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/Component2_3.png}
    \end{center}
    \label{fig:componentdiagram}
	\caption{Component diagram of the system.}
\end{figure}

\begin{itemize}
\item \textbf{Mobile Client} and \textbf{Web Client}: the client device that accesses to the functionalities of the entire system. It will be implemented implemented using the thin clien approach.
\item \textbf{Presentation}: a Web Client, accessing through the browser, needs this component in order to display the web pages of the application. This layer only provides the structure of the user interface without accessing any data or application logic.
\item \textbf{User Controller}: it takes care of all the operations related to the user's data. It exposes methods to change account credentials and it stores the user's data in the database using the Storage Interface.
\item \textbf{Auth Controller}: it takes care of all the authentication-related operations: it is responsible both for the log in and the registration process, and it also uses the \textit{Storage Interface} to retrieve and store new users' credentials in the databse. During the registration process, the Auth Controller uses the \textit{Mail Service Interface} to communicate with the Mailing Service in order to send registration emails.
\item \textbf{History Manager}: its functionality is to retrieve and show to the Client his/her report's history.
\item \textbf{Report Manager}: it's a \textit{subsystem} component in charge of all the processing functions on the newly recieved reports:
\begin{itemize}
    \item \textbf{Report Interface}: it exposes to the User an interface in the form of a blank report to be compiled.
    \item \textbf{Report Controller}: it aims to check the validity of the sent reports. To do this, it communicates with the Report Interface to check them as soon as they are recieved.
    \item \textbf{Notify Controller}: the role of this component is to select the correct authorities to notify based on their municipality, using his \textit{AuthorityList}. It depends on the Report Controller, in the sense that it will notify the authorities only if the check of the report is successful and the type of the report is \textit{Traffic Violation}.
    \item \textbf{Security Manager}: it takes care of the security side: as specified in the Security section of the RASD, before being stored, the report is encrypted so that no one can access it besides some specific system components. This component also depends on the Report Controller verification process, due to the fact that if the report doesn't pass it, it will be discarded and therefore never encrypted.
\end{itemize}
\item \textbf{Storage Interface}: its main purpose is to retrive the reports from the database, decoupling the other components of the system from the specific data sources. This component is also in charge of authenticating the system with local municipalities' systems, and eventually crossing their data with SafeStreets' own information. Also, since the most recent version of the statistics and the suggestions are computed whithin the AI Controller and the Statistics Controller, this component is also in charge of keeping the stored version of the data up to date, eventually resolving data conflicts due to the replication of the mentioned components.
\item \textbf{DB}: this component represents the DBMS, which provides an interface to read and store data. User credentials, submitted reports, and older statistics and suggestions are stored in the database.
\item \textbf{Information Manager}: a \textit{subsystem} in charge of building statistics, compute safety suggestions and deploy them to the users who requested them.
    \begin{itemize}
        \item \textbf{StatisticsSuggestions Interface}: it exposes to the users the latest statistics and safety suggestions. As aready mentioned in the RASD, the exposed data may be different according to the level of visibility granted to different users.
        \item \textbf{Statistics Controller}: it analyzes the stored reports to build statistics such as unsafe urban areas, most frequent violations, and offenders. Depending on the agreements with local municipalities, this component can also compute statistics on iussued traffic tickets or refine its statistics about accidents.
        \item \textbf{AI Controller}: its role is to analyze previously built statistics and compute safety suggestions. These suggestions are addressed to the authorities who use the SafeStreets application.
        \item \textbf{Security Manager}: similarly to the one described in the Report Manager subsystem, this component is in charge of decrypting stored reports so that they can be analyzed. To ensure that no report is ever altered, this component can perform read-only operations, whereas the one in the Report Manager is the ony one which disposes of write permissions.
    \end{itemize}
\item \textbf{Municipality Interface}: this component represents the point of access to the municipality's system. Its main tasks are to interact with the Auth Controller to confirm the validity of the badge number provided by users, to grant or refuse the access of the Storage Interface to the municipality's database, and eventually to mediate the retrieving data process.
\item \textbf{External Services Interfaces}: it's a set of components whose main task is to make an API call to the corresponding third party service.
    \begin{itemize}
        \item \textbf{Mail service Interface}: it's an interface towards the mailing service, which is in charge of sending confirmation mails at the end of the registration process.
        \item \textbf{OCR service Interface}: it calls a service used by the Report Manager to read license plates from pictures submitted in the reports by users.
        \item \textbf{Map service Interface}: it provides the users with the functionality of visualizing the statistics (and their own position) on a geographic area using an interactive map.
\end{itemize} 
\end{itemize}
\section{Deployment view}
In this section it is described the deployment view of the components inside the system. The deployment diagram shows the distribution of hardware components.
\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/DeploymentView.png}
    \end{center}
    \label{fig:deploymentview}
	\caption{Deployment diagram of the system.}
\end{figure}\\
The system is composed of a multitier architecture and each specific role is clarified below.\\
\begin{itemize}
    \item \textbf{Client}\\
    The first tier contains the mobile clients which installed the SafeStreets application and the desktop clients which accessed its functionalities via web browser.\\
    \item \textbf{Web Server}\\
    A web server is used to store, process and deliver web pages to desktop
    clients. The communication between client and server takes place using the
    Hypertext Transfer Protocol (HTTP).
    \item \textbf{Reverse Proxy}\\
    The second tier contains a reverse proxy to implement the load balancing of the several requests towards the application servers.
    Furthermore, a reverse proxy works as a single point of access which improves the security and enables a caching function which can speed-up the most frequent requests.
    Linux machine have been chosen for safety and simplicity. \\
    \item \textbf{Application servers}\\
    This is the logic level of the application where all the computations happen, which corresponds to the second tier of the architecture. The servers
    are distributed to increase the scalability, reliability and availability of the network.\\
    \item \textbf{Firewall}\\
    The access to the Database is protected from a firewall to avoid unauthorized accesses to sensible data.\\
    \item \textbf{Database Server}\\
    This is the last layer of the architecture. All the data are stored here structured in a relational DBMS.
\end{itemize}
\newpage
\section{Runtime view}

\subsection{Registration Runtime View}
\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/Registration1.png}
    \end{center}
    \label{fig:RegistrationSD}
	\caption{Registration Runtime View.}
\end{figure}
The guest has to register before accessing the functionalities of the application. The guest fills a form containing with his/her authentication credentials. The credentials are sent to the Application Server through an HTTP POST. The \textit{Authentication Controller} handles the request and verifies that the information are valid and complete. Then it generates an URL that it is forwarded by the external mailing system to the uest. Once the guest confirms the registration clicking on the URL link, the \textit{Storage Interface} insert the new user with its credentials in the database, so from this moment on the new user is able to authenticate and to use the functionalities of the application.
In the event that is an authority to register, once the authority has filled and sent the form, the \textit{Authentication Manager} contacts the \textit{Municipality Interface} to be sure that the entered badge number is correct. If the Municipality Interface replies that the provided badge number is correct, the registering procedure is the same as before; otherwise an HTTP Error is sent back to the guest that has sent the information.    

\subsection{Login Runtime View}
\begin{figure}[H]
	\begin{center}
	\includegraphics[width=\textwidth]{img/Login1.png}
    \end{center}
    \label{fig:LoginSD}
	\caption{Login Runtime View.}
\end{figure}
The Client to access the functionalities of the application has to log in (clearly as specified before he/she must be registered). The Client fill the Log in form with his/her credentials. The provided information are sent to the Application Server through an HTTP POST. The \textit{Authentication Controller} handles the request and checks the information. It interfaces with the \textit{Storage Interface} that runs a SELECT query on the Database to verify the existence of the User. If the query return a result an HTTP Success message is return to the Client that now is able to access to the functionalities of the application, otherwise an HTTP Error is send back to the Client that is not able to log in successfully.
%\newpage
\subsection{Send Report Runtime View}
\begin{figure}[H]
	\begin{center}
	\includegraphics[width=\textwidth]{img/SendReport1.png}
    \end{center}
    \label{fig:SendReportSD}
	\caption{Send Report Runtime View.}
\end{figure}
The User (Citizen in this case) is logged in and opens the section to send the report. The \textit{Report Interface} provides the report form that has to be filled. The \textit{Report Interface} interfaces also with the \textit{Report Controller}, so once the report is compiled and sent by the User, the Report Interface shows it to the Report Controller so that it can checks its consistency. 
If the User has not inserted the license plate in the report, the Report Controller uses an external OCR service system, that execute an OCR algorithm to retrieve the license plate from the picture provided by the User.
At this point, when all the information are avaiable, the report is shared with the \textit{Notify Controller} which will check its Authority list to notify the right Authority.
Then using the \textit{Security Manager} the report is encrypted and stored in the Database using the \textit{Storage Interface}, that runs an INSERT query. 
\newpage
\subsection{Compute Statistics Runtime View}
\begin{figure}[H]
	\begin{center}
	\includegraphics[width=\textwidth]{img/ComputeStatistics.png}
    \end{center}
    \label{fig:ComputeStatisticSD}
	\caption{Compute Statistics Runtime View.}
\end{figure}
The procedure to compute the statistics is performed by the \textit{Information Manager}. In particular the \textit{
Security Manager} uses the Storage Interface to retrieve all the report. So it decrypt them and requests the \textit{Statistic Controller} to compute the statistics on them. If the Municipality has given the permission to process the data relative to the traffic tickets, the Storage Interface retrieve them contacting the \textit{Municipality Interface} (external to the system).
When an User taps on Statistic button, a GET request is send to the StatisticsSuggestions Interface, that retrieves the avaiable statistics from the Statistic Controller and shows them to the User. An HTTP Success message is also send back to the User.    
\subsection{Compute Suggestion Runtime View}
\begin{figure}[H]
	\begin{center}
	\includegraphics[width=\textwidth]{img/ComputeSuggestions.png}
    \end{center}
    \label{fig:SuggestionsSD}
	\caption{Compute Suggestions Runtime View.}
\end{figure}
The procedure to compute the suggestions is performed as soon as the statistics are computed and avaiable. So at this moment, the Statistic Controller send the already computed statistics to the \textit{Ai Controller}, that runs some smart algorithms to compute useful suggestions. As for the statistics, whenever an User taps on Suggestion button, a GET request is send to the StatisticsSuggestions Interface that retrieve the suggestions from 
the AI Controller and shows them to the User. Notice that only User authenticated as Authority can visualize the suggestions.
\subsection{History Report Runtime View}
\begin{figure}[H]
	\begin{center}
	\includegraphics[width=\textwidth]{img/HistoryReport.png}
    \end{center}
    \label{fig:HistoryReportSD}
	\caption{Report's History Runtime View.}
\end{figure}
The User is logged in and want to retrieve all the reports he/she has sent up to that moment with a GET request. The \textit{History Manager} handles this request and interfacing with the Storage Interface tries to retrieve all the reports relative the specific User. So the Storage Interface runs a query on the Database and if there are reports corresponding to the User who requested it, an HTTP Success message is returned back to the User and the Storage Manager shows the reports; otherwise an HTTP Error is send back to the User.
If the User that request the Report's History is an Authority the History Manager retrieves and shows all the Report based on the report's date selected by the Authority.   

\section{Component Interfaces}
\subsection{API REST}
\begin{center}\large{\textbf{Authentication Controller}}\end{center}
The \textit{Authentication Controller} provides methods for login and registration.
The Authentication Controller exposes the following methods: \\

\begin{center}{\textbf{Registration}}\end{center}
\begin{tabular}{| l | p{8cm} |}
    \hline
    \textbf{Endpoint} & */auth/register \\
    \hline
    \textbf{Method} & POST \\
    \hline
    \textbf{Data Params} & username: [string] \newline email: [string] \newline password: [string] \newline If the user is an authority: \newline municipality: [string]\\
    \hline
    \textbf{Success Response} & code: 200 \newline body: {message: "Registration successful"} \newline \newline code:202 \newline body: {message: "Accepted request"}\\
    \hline
    \textbf{Error Response} & code: 400 \newline body: {error: "Failed check"} \newline \newline code: 401 \newline body: {error: "Unauthorized access"} \newline \newline code: 422 \newline body: {error: "Unprocessable entity"}   \\
    \hline
    \textbf{Notes} & Allows the user to request the registration as citizen or authority \\
    \hline
\end{tabular}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\\
\begin{center}{\textbf{Login}}\end{center}
\begin{tabular}{| l | p{8cm} |}
	\hline
	\textbf{Endpoint} & */auth/login \\
	\hline
	\textbf{Method} & POST \\
	\hline
	\textbf{Data Params} & username: [string] \newline password: [string]\\
	\hline
	\textbf{Success Response} & code: 200 \newline content: {accessToken: [string]} \newline \newline code:202 \newline body: {message: "Accepted credentials"}\\
	\hline
    \textbf{Error Response} & code: 401 \newline body: {error: "Unauthorized access"} \\
	\hline
	\textbf{Notes} & Allows the client to obtain an authentication Token \\
	\hline
\end{tabular}
\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}{\textbf{Activate Account}}\end{center}
    \begin{tabular}{| l | p{8cm} |}
        \hline
        \textbf{Endpoint} & */auth/activate \\
        \hline
        \textbf{Method} & GET \\
        \hline
        \textbf{Data Params} & \\
        \hline
        \textbf{Success Response} & code: 200 \newline content: {message: "Account activated"}\\
        \hline
        \textbf{Error Response} & code: 404 NOT FOUND \newline content: {error: "Incorrect activation code"} \newline \newline code: 401 \newline body: {"error": "Account not activated"} \newline \newline code: 401 \newline body: {error: "Wrong password"} \newline \newline code: 401 \newline body: {error: "Provided email does not exist"}   \\
        \hline
        \textbf{Notes} & Allows a Client to activate the account \\
        \hline
    \end{tabular}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\\\\
\begin{center}\large{\textbf{Report Controller}}\end{center}
The \textit{Report Controller} handles the submission of the User, in this case the Citizen. The use of the send method is condi-
tional on the Citizen authentication which is handled by the \textit{Authentication Controller}.\\

\begin{center}{\textbf{Send Report}}\end{center}
    \begin{tabular}{| l | p{8cm} |}
        \hline
        \textbf{Endpoint} & */send \\
        \hline
        \textbf{Method} & POST \\
        \hline
        \textbf{Data Params} & date: [string] \newline time: [string] \newline license plate: [string] \newline picture: [png/jpg]\\
        \hline
        \textbf{Success Response} &  code: 200 \newline content: {message: "Report received successfully"} \newline \newline code:202 \newline body: {message: "Accepted request"}\\
        \hline
        \textbf{Error Response} & code: 400 BAD REQUEST \newline body: {error: "Data not correct"}\\
        \hline
        \textbf{Notes} & Allows the Citizen to send a report to the system. \\
        \hline
    \end{tabular}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\\
\begin{center}\large{\textbf{History Manager}}\end{center}
    The \textit{History Manager} handles the request of the User providing an old report stored in the database. When a date is selected, the corrisponding old report is requested and delivered to the User.
\begin{center}{\textbf{Get old report}}\end{center}
    \begin{tabular}{| l | p{8cm} |}
        \hline
        \textbf{Endpoint} & */get \\
        \hline
        \textbf{Method} & GET \\
        \hline
        \textbf{Data Params} & old date: [string]\\
        \hline
        \textbf{Success Response} &  code: 200 \newline content: {message: "Report received successfully"}\\
        \hline
        \textbf{Error Response} & code: 404 \newline body: {error: "Report not found"}\\
        \hline
        \textbf{Notes} & Allows the User to get an old report. \\
        \hline
    \end{tabular}


\section{Selected architectural	styles and patterns}
The following architectural patterns are used to build the structure of the system in order to provide all the services of SafeStreets application.\\

\begin{center}\large{\textbf{Client-Server Architecture}}\end{center}
Client-Server architecture is a computing model that features two roles: a Server that hosts, delivers and manages most of the resources and services, and a Client which exploits them.
\begin{center}\large{\textit{Motivations}}\end{center}
\noindent This structure provides several advantages:
\begin{itemize}
    \item Scalability and Mantainability: it is possible to repair or add more resources to the architecture without significative service interruptions.
    \item Security: the server is able to manage what levels of access each user can have with respect to specific resources.
\end{itemize}\vspace{2mm}

\begin{center}\large{\textbf{Three-tiered Architecture}}\end{center}
This type of architecture is a kind of Client-Server paradigm where three tiers are phisically separated:
\begin{itemize}
	\item The \textit{presentation tier} is the top-most level of the architecture, which provides an interface that users can use to directly access the application. 
	It is the top-most tier and the only one accessible from the Client.
	\item The \textit{application tier} runs the business logic of the application and executes functions that elaborate data. 
	A Reverse Proxy is needed to handle the Client requests and to balance the workload, the requests are forwarded to 
	the application serves in order to provide the right data.
	\item The \textit{database tier} includes the data persistence mechanisms and the data access layer that encapsulates 
	the persistence mechanisms and exposes the data.
\end{itemize}
\begin{center}\large{\textit{Motivations}}\end{center}
A multi-tier application architecture provides a model with several advantages: in this way developers can create flexible and reusable 
applications that can be modified, enhanced or maintained just by operating on a specific layer, instead of reworking the entire application. Furthermore, a general multitier architecture can also help improve the development efficiency by allowing teams to focus on their core competencies.

\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/TiersArchitecture.png}
	\end{center}
	\caption{Three-tier architecture schema.}
\end{figure}

\begin{center}\large{\textbf{MVC Design Pattern}}\end{center}
Model-View-Controller is a software design pattern commonly used to develop user interfaces. Indeed, this pattern is used for the front-end implementation of the application. It divides the program logic in three interconnected elements: \textit{model} that directly manages data and rules of the application, \textit{view} which handles any representation of data, \textit{controller} that 
accepts input and converts it to commands for the model or view. This mechanism is used to separate internal representation of information from the ways information is presented to and accepted from the user. 
\begin{center}\large{\textit{Motivations}}\end{center} 
MVC allows full encapsulation of objects. This means that each component can be changed without creating issues to other components.
Furthermore, MVC provides decopuling of its components, which means that developers are able to work in parallel on different components of the pattern without interfering with each other.

\begin{center}\large{\textbf{Reverse Proxy Design Pattern}}\end{center}
A simple proxy acts as an interface to refer an object in another machine. The reverse proxy offers a single point of access (with HTTP) to multiple Clients who want to access to several application servers. In practice, it is a wrapper for an object behind the scenes. 
Proxies also provides extra functionalities such as data caching (g.e. store the newest statistics available) and security (g.e. client-side firewall).
\begin{center}\large{\textit{Motivations}}\end{center} 
It is useful to organize the requests of multiple clients and to save frequent requested informations. It also protects the application servers from external attack and slightly improve the overall performances.

\begin{center}\large{\textbf{REpresentational State Transfer}}\end{center}
REST is software architectural style that has become a standard in the creation of Web API. It describes those types of interfaces capable of exchanging data and enabling CRUD operations through HTTP requests, without using auxiliary technologies like cookies or other protocols. This architecture makes the communication client-server totally stateless (every request is independent from the others), and also allows for different representations of a resource (g.e statistics) based on who is accessing it (g.e. user from a certain location).
\begin{center}\large{\textit{Motivations}}\end{center}
We decide to use REST to simplify the design and the implementation of the application. Indeed, the developers do not need to take in account the traceability of states. REST also enables a design approach based on microservices.

\section{Other Architectures}
\begin{center}\large{\textbf{Thin Client}}\end{center}
A thin Client is a lightweight computer which does most of the computation in a remote Server. In this paradigm in fact, since the Servers take care of several duties such as storage 
of data and performing calculations, the Client does not need to have a large memory or powerful computing capabilities to run the application.
\begin{center}\large{\textit{Motivations}}\end{center} 
The application is thought mostly for mobile phones which do not have great computing power or very large memories. Thanks to a thin client a internet connection is virtually the only requirements to use the application. Furthermore, this architecture simplify the front-end implementation by shifting most of the execution to the servers.

\begin{center}\large{\textbf{Microservices}}\end{center}
Microservices is a software development technique that is based on developing a single application as a suite of smaller services. Each service runs its own process and is independently deployable from the other, and its interactions with other microservices are orchestrated using a RESTful approach based on communicating with lightweight mechanisms (HTTP).
\begin{center}\large{\textit{Motivations}}\end{center}
A microservices approach favors a decentralized management of the system's functionalities by loosely copuling its subsystems. This approach promotes information hiding between different services, gives rise to high resilience to failures (which are isolated whithin the subsystem involved), and allows to replicate each service according to its usage rather than duplicating the whole application. 

\chapter{User Interface Design}
\section{Mockup}
The mockups of the mobile application can be found in the RASD in the chapter \textit{Specific Requirements}. Here we present an hypothetical view of the web application.
\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/MockupAppWeb.png}
	\end{center}
	\caption{Web page graphics.}
\end{figure}

\section{User Experience Diagram}
The User Experience diagram (UX) diagrams reported below provide additional information about the User
Interface that the application provides. The diagrams show the basic core actions
that can be performed by the user through the mobile application. 

\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/AuthoritiesUX.png}
	\end{center}
    \caption{UX flow of an authority user.}
    
\end{figure}\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/CitizenUX.png}
	\end{center}
	\caption{UX flow of a citizen user.}
\end{figure}

\chapter{Requirements Traceability}
All the decisions and the architectural choices taken in this document aim to achieve all the requirements defined in chapter 3 of the RASD. In this chapter it will be shown, for each requirement, which component or part of the system will accomplish them.

\section{Functional Requirements}
In the following table it is shown which components of the system are in charge of carrying out the functional requirements defined in section 3.2 of the RASD.

\begin{tabularx}{\linewidth}{| c || c |}
    \hline
    \endfoot

    \hline
\textbf{Component(DD)} & \textbf{Requirement(RASD)}\\
	\hline
	\hline
    \large{Auth Controller} & \parbox{0.45\textwidth}{ \vspace{2mm}
    $\bullet$ {[R.1]} A visitor must be able to register. During the registration the System will ask to provide some credentials. \\

	$\bullet$ {[R.2]} Check if the guest credentials are valid \\

	$\bullet$ {[R.3]} If credentials are valid, the System sends a confirmation email \\

	$\bullet$ {[R.4]} Allow to log in using personal credentials. \\

    $\bullet$ {[R.13]} Provide a recognition system of badge number.\\
     
    $\bullet$ {[R.20]} Use third party services to enable some functions (Mail Service).\\}\\
        
    \hline
    \large{User Controller} & \parbox{0.45\textwidth}{ \vspace{2mm} 
    $\bullet$ {[R.5]} Allow to change username, only if the new username is not already in use by another User, email, only if the new email is in a correct format and password, only if the new password is different from the precedent and respects the minimum length. \\

	$\bullet$ {[R.6]} Send a confirmation email if username, email or password is changed (similarly to the registration process). \\

	$\bullet$ {[R.7]} Allow to change password if it has been forgotten, through the personal email. \\

    $\bullet$ {[R.14]} Allow the Citizen to consult the history of its personal reports.\\
    
    $\bullet$ {[R.20]} Use third party services to enable some functions (Mail Service).\\} \\

	\hline
    \large{Report Interface} & \parbox{0.45\textwidth}{ \vspace{2mm} 
    $\bullet$ {[R.8]} The Citizen must be allowed to create reports \\} \\

    \hline
    \large{Report Controller} & \parbox{0.45\textwidth}{ \vspace{2mm} 
    $\bullet$ {[R.9]} Check if the Report created by the Citizen is valid. \\

    $\bullet$ {[R.20]} Use third party services to enable some functions (OCR Service).\\}\\

	\hline
    \large{Notify Controller} & \parbox{0.45\textwidth}{ \vspace{2mm} 
    $\bullet$ {[R.10]} Notify the Authorities whenever a new Report is submitted. \\

	$\bullet$ {[R.16]} All traffic violations must be notified to Authorities according to their municipality.\\}\\
		
	\hline
    \large{Map Service Interface} & \parbox{0.45\textwidth}{ \vspace{2mm} 
    $\bullet$ {[R.15]} Allow Users to see the their position in a map.\\

    $\bullet$ {[R.20]} Use third party services to enable some functions (Map Service).\\}\\
		
	\hline
	\large{History Manager} & \parbox{0.45\textwidth}{ \vspace{2mm}
    $\bullet$ {[R.17]} Provide the Authorities with a list of the most recent reports submitted. \\

	$\bullet$ {[R.18]} Allow Authorities to also consult older Reports. \\}\\

	\hline
    \large{Storage Interface} & \parbox{0.45\textwidth}{ \vspace{2mm}
    $\bullet$ {[R.19]} Interact with the Municipality's System to get the permission for using their data.\\

	$\bullet$ {[R.24]} Cross the data coming from external DBMSs with the System's own data.\\}\\

	\hline
    \large{Security Manager} & \parbox{0.45\textwidth}{ \vspace{2mm}
    $\bullet$ {[R.22]} Provide protection of data using encryption.\\

	$\bullet$ {[R.28]} After its validation, no one should be able to modify a submitted Report.\\}\\


	\hline
    \large{StatisticsSuggestions Interface} & \parbox{0.45\textwidth}{ \vspace{2mm} 
    $\bullet$ {[R.11]} Provide two different level of visibility regarding the statistics. Only the Authorities can consult statistics with private data. \\

    $\bullet$ {[R.12]} SafeStreets' application must show the most recent version of the suggestions and statistics.\\}\\
    
	\hline
    \large{Statistic Controller} & \parbox{0.45\textwidth}{ \vspace{2mm}
    $\bullet$ {[R.23]} Acknowledge whether or not multiple istances of Reports are referred to the same infraction, even if protracted over time.\\

    $\bullet$ {[R.25]} Cross data from different Reports in order to establish their truthfulness.\\

    $\bullet$ {[R.21]} Statistics and suggestions have to be periodically recomputed\\}\\

	\hline
    \large{AI Controller} & \parbox{0.45\textwidth}{ \vspace{2mm}
    $\bullet$ {[R.26]} Unsafe areas are detected by means of an artificial intelligence.\\

	$\bullet$ {[R.27]} Safety Suggestions are computed by means of an artificial intelligence.\\}\\
    \hline
    
\end{tabularx}
\captionof{table}{Functional requirements mapping on system's component}

\section{Non-Functional Requirements}
The non-functional requirements defined in Section 3.3 and 3.5 of the RASD are mainly a matter of concern for the development team. However, design choices such as the three-tier architecture and the microservices approach aim for increased performances and in general to improve the software quality attributes.

\chapter{Implementation, Integration and Test Plan}
As previously illustrated in the Component Diagram, the System is made of many components that can be divided into the following categories:
\begin{itemize}
\item \textbf{Frontend components}: Client application.
\item \textbf{Backend components}: User controller, Authentication controller, Report controller, History Manager, Notify controller, Security Manager, AI controller, Statistic controller, StatisticSuggestion Interface and Storage Interface.
\item \textbf{External components}: DB, Mail service interface, OCR service interface, Map service Interface and Municipality Interface.
\end{itemize}
In order to implement, integrate and test the system, a bottom-up approach will be used, considering also the importance of the various functionalities. Thus, since some components are grouped into subsystems as illustrated in the Figure \ref{fig:componentdiagram}, the components in the same subsystem will be implemented, integrated and tested first and then the subsystems will be integrated and tested together in order to verify the correct behaviour of the system. As specified in the RASD, the System is not responsible for failures of third party services, so the components of the external subsystems don't need to be tested and are assumed to be reliable. Therefore the implementation and integration process will be performed in two phases:
\begin{enumerate}
\item Implementation and integration of each component of the same subsystem;
\item Integration of different subsystems;
\end{enumerate}
The following table lists the main features avaiable to the customer. Their importance and implementation difficulty is shown below to better understand the decision about implementation, testing and integration that will be taken in the rest of this section.
\clearpage

\begin{table}

\bgroup
\def\arraystretch{1.5}
\resizebox{\textwidth}{!}{
\begin{tabular}{| c || c | c |}
    \hline
    \textbf{Functionality} & \textbf{Importance for the customer} & \textbf{Difficulty 
    of implementation}\\

    \hline
    \hline
    Sign up and login & \textit{Low} & \textit{Low} \\

    \hline
    Consult older reports & \textit{Medium} & \textit{Low} \\

    \hline
    Use external map services & \textit{Medium} & \textit{Low} \\

    \hline
    Report a violation & \textit{Medium} & \textit{Medium} \\

    \hline
    Visualize statistics & \textit{High} & \textit{High} \\

    \hline
    Visualize suggestions & \textit{Medium} & \textit{High} \\

    \bottomrule
\end{tabular}
}
\egroup
\caption{Main functionalities with their importance and implementation difficulty}
\end{table}

\noindent Regarding the first phase, components integration of the same subsystem will be applied only for backend components. More specifically, the components to be integrated and tested together, as showed in the Component Diagram, are:
\begin{itemize}
\item User Controller and Storage Interface, forming the \textit{User subsystem};
\item Authentication Controller and Storage Interface, forming the \textit{Authentication subsystem};
\item History Controller and Storage Interface, forming the \textit{HistoryReport subsystem}
\item Report Interface, Report Controller, Notify Controller and Security Manager, forming the \textit{Report Manager subsystem}.;
\item AI Controller, StatisticSuggestion Interface, Statistic Controller and Security Manager, forming the \textit{Information Manager subsystem}.
\end{itemize}
Also the Report Manager and Information Manager, as well as the first three subsystems listed above, will use the Storage Interface to interact with the DB. Moreover, the User and the Authentication subsystems use the \textit{Mail Service Interface}; the latter one interact also with the \textit{Municipality Interface}. Finally the Report Manager could use the \textit{OCR Service Interface}. So in the implementation and integration process these components must also be taken into account. 
Considering that the Storage interface is used by a lot of components and therefore also by many subsystems, it will be useful to implement and test it first and then try to integrate it with the other components/subsystems. 
\newline
\newline
For the second step all higher-level subsystems will be integrated. In particular, this integration activity involves the Business Logic and the Client subsystem.
\newline
It is important that the verification and validation processes starts as soon as the development of the system begins in order to find errors as quickly as possible. As specified above, an incremental approach is used for the integration process, so that bug tracking is more easier. Moreover, also scaffolding techniques must be used when needed: in particular due to the fact that the frontend and the external subsystems are independent, the external services will be used in place of stubs to test the interfaces.
\newline
At the end, when the integration system is completed, the whole system is tested: for this purpose a fundamental type of test is the performance test that is useful to identify bottlenecks affecting the response time, the utilization and the throughput. It identifies also inefficient algorithms, Hardware/Network issues and Query optimimzation possibilities and this is very important since in this system there are a lot of interactions with the database. 
\newpage
\section{Sequence of Component Integration}
The following diagrams describe the process of implementation, integration
and testing. The arrow goes from the used component/subsystem to the
component/subsystem that uses it.
\subsection{Integration of the backend subsystem}
All the components are first implemented and unit tested. Then some of the components are integrated into subsystem and integration tests will be performed. The integrations are the following:
\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/UserSub.png}
    \end{center}
    \label{fig:UserSub}
	\caption{User subsystem.}
\end{figure}
\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/AuthSub.png}
    \end{center}
    \label{fig:AuthSub}
	\caption{Authentication subsystem.}
\end{figure}

\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/HistorySub.png}
    \end{center}
    \label{fig:HistorySub}
	\caption{HistoryReport subsystem.}
\end{figure}
\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/ReportSub.png}
    \end{center}
    \label{fig:ReportSub}
	\caption{Report Manager subsystem.}
\end{figure}

\begin{figure}[!ht]
	\begin{center}
	\includegraphics[width=\textwidth]{img/InfoSub.png}
    \end{center}
    \label{fig:InfoSub}
	\caption{Information Manager subsystem.}
\end{figure}


\begin{figure}[!ht]
    \subsection{Integration of backend and frontend}
    When all the components of the backend are fully implemented, integrated and tested, the frontend will be integrated and tested with the backend: in particular it will be integrated the Client subsystem with the Report Manager subsystem, Information Manager subsystem, HistoryReport subsystem, User subsystem and Authentication subsystem. 
    \vspace{1cm}
    \begin{center}
	\includegraphics[width=\textwidth]{img/ClientSub.png}
    \end{center}
    \label{fig:ClientSub}
	\caption{Client subsystem.}
\end{figure}

\begin{figure}[!ht]
    \subsection{System integration}
At the end of the previuous procedures the \textit{frontend}, \textit{backend} and \textit{External Components/Subsystems} are integrated and tested together.
\vspace{1cm}    
\begin{center}
	\includegraphics[width=\textwidth]{img/SystemSub.png}
    \end{center}
    \label{fig:SysSub}
	\caption{Integration of the whole System.}
\end{figure}

\chapter{Effort Spent}
\subsection*{Alice Casali}
\begin{table}[!ht]
	\begin{tabular}{|C{.60\textwidth}||C{.20\textwidth}|}
		\toprule
        \textbf{Task} & \textbf{Hours}\\
        \midrule
        Discussion about architectural design & 3\\
        \midrule
        High-level architecture diagram & 3\\
        \midrule
        Architectural Structures & 4\\
        \midrule
        MVC explanation & 2\\
        \midrule
        Deployment View & 3\\
        \midrule
        Added REST architecture & 2 \\
        \midrule
        Fixed Deployment View & 1\\
        \midrule
        API REST table for Computation Interfaces & 4\\
		\midrule
		User interface mockup & 2\\
        \midrule
        User interface UX diagrams & 3\\
        \midrule
		\small{\textbf{Recap Call}}: & \\
		\vspace{.2mm}
		$\bullet$ Discussion on the consistency between the document & \vspace{.2mm} 1\\
        $\bullet$ Schedule of missing sections & 1\\
        \midrule
        Added new API REST table & 2\\
        \midrule
        Relational database & 2\\
        \midrule
		Sequence Diagram review & 2\\
		\midrule
		& \textbf{Total:} 35\\
		\bottomrule
	\end{tabular}
\end{table}
\end{document}